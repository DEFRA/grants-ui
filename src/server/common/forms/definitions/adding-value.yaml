engine: V2
name: Adding value
metadata:
  referenceNumberPrefix: AV
  gas:
    grantCode: adding-value-v3
    submissionSchema:
      $schema: https://json-schema.org/draft/2020-12/schema
      title: GrantApplicationPayload
      type: object
      properties:
        $$__referenceNumber:
          type: string
        businessNature:
          type: string
        businessLegalStatus:
          type: string
        isInEngland:
          type: boolean
        planningPermissionStatus:
          type: string
        projectStartStatus:
          type: string
        isLandBusinessOwned:
          type: boolean
        hasFiveYearTenancyAgreement:
          type: boolean
        isBuildingSmallerAbattoir:
          type: boolean
        isBuildingFruitStorage:
          type: boolean
        isProvidingServicesToOtherFarmers:
          type: boolean
        eligibleItemsNeeded:
          type: array
          items:
            type: string
        needsStorageFacilities:
          type: string
        estimatedCost:
          type: number
        canPayRemainingCosts:
          type: boolean
        processedProduceType:
          type: string
        valueAdditionMethod:
          type: string
        impactType:
          type: array
          items:
            type: string
        hasMechanisationUsage:
          type: boolean
        manualLabourEquivalence:
          type: string
        grantApplicantType:
          type: string
        agentFirstName:
          type: string
        agentLastName:
          type: string
        agentBusinessName:
          type: string
        agentEmail:
          type: string
          format: email
        agentEmailConfirmation:
          type: string
          format: email
        agentMobile:
          type: string
        agentLandline:
          type: string
        agentBusinessAddress__addressLine1:
          type: string
        agentBusinessAddress__addressLine2:
          type: [string, null]
        agentBusinessAddress__town:
          type: string
        agentBusinessAddress__county:
          type: [string, null]
        agentBusinessAddress__postcode:
          type: string
        applicantFirstName:
          type: string
        applicantLastName:
          type: string
        applicantEmail:
          type: string
          format: email
        applicantEmailConfirmation:
          type: string
          format: email
        applicantMobile:
          type: string
        applicantLandline:
          type: string
        applicantBusinessAddress__addressLine1:
          type: string
        applicantBusinessAddress__addressLine2:
          type: [string, null]
        applicantBusinessAddress__town:
          type: string
        applicantBusinessAddress__county:
          type: [string, null]
        applicantBusinessAddress__postcode:
          type: string
        applicantProjectPostcode:
          type: string
      required:
        - $$__referenceNumber
        - businessNature
        - businessLegalStatus
        - isInEngland
        - planningPermissionStatus
        - projectStartStatus
        - isLandBusinessOwned
        - isBuildingSmallerAbattoir
        - estimatedCost
        - canPayRemainingCosts
        - hasMechanisationUsage
        - grantApplicantType
        - applicantFirstName
        - applicantLastName
        - applicantEmail
        - applicantEmailConfirmation
        - applicantMobile
        - applicantLandline
        - applicantBusinessAddress__addressLine1
        - applicantBusinessAddress__town
        - applicantBusinessAddress__postcode
        - applicantProjectPostcode

pages:
  - title: Check if you can apply for a Farming Transformation Fund Adding Value Grant
    path: /start
    controller: StartPageController
    components:
      - name: startInfoOne
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">Use this service to:</p>

          <ul class="govuk-list govuk-list--bullet">
          <li>check if you can apply for a grant for your project (takes about 5 minutes)</li>
          <li>check how well your project fits the funding priorities (takes about 15 minutes if you have all the project details)</li>
          </ul>

          <p class="govuk-body">You can apply if you:</p>

          <ul class="govuk-list govuk-list--bullet">
          <li>are a grower or producer of agricultural or horticultural produce</li>
          <li>are a business processing agricultural or horticultural products that is at least 50% owned by agricultural or horticultural producers</li>
          <li>will do the grant-funded work in England</li>
          <li>estimate the project costs are over Â£62,500</li>
          </ul>
      - name: startInsetText
        title: Inset text
        type: InsetText
        content: If your project is eligible, you can submit your answers to the Rural Payments Agency (RPA) to request the full application form.
      - name: startInfoTwo
        title: Html
        type: Html
        content: |-
          <h2 class="govuk-heading-s">Before you start</h2>
          <p class="govuk-body">To use the checker, you need:</p>
          <ul class="govuk-list govuk-list--bullet">
          <li>information about your business (for example, number of employees, turnover)</li>
          <li>information about the project (for example, the types of products being processed and how you will add value, the impact the project will have)</li>
          <li>a list of the items you'd like to buy for the project</li>
          <li>an estimate of the total cost of the items</li>
          </ul>
          <p class="govuk-body">If you do not enter any information for more than 20 minutes, your application will time out and you will have to start again.</p>

          <h2 class="govuk-heading-s">Problems using the online service</h2>
          <p class="govuk-body">If you have any problems using the online service, contact the RPA.</p>

          <h2 class="govuk-heading-s">Telephone</h2>
          <p class="govuk-body">Telephone: 03000 200 301</p>
          <p class="govuk-body">Telephone: 03000 200 301</p>

          <p class="govuk-body">Monday to Friday, 9am to 5pm (except public holidays)</p>

  - title: What is your business?
    path: /nature-of-business
    components:
      - name: businessNature
        title: What is your business?
        type: RadiosField
        list: natureOfBusinessList
        hint: Select one option
        options:
          customValidationMessages:
            any.required: Select the option that applies to your business

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-nature-of-business
    controller: TerminalPageController
    components:
      - name: natureOfBusinessCannotApply
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">This grant is for businesses who:</p>

          <ul class="govuk-list govuk-list--bullet">
          <li>are agricultural or horticultural growers or producers</li>
          <li>are a business processing agricultural or horticultural products that is at least 50% owned by agricultural or horticultural producers</li>
          </ul>

          <p class="govuk-body">See other grants you may be eligible for.</p>
    condition: natureOfBusinessCondition

  - title: What is the legal status of the business?
    path: /legal-status
    components:
      - name: businessLegalStatus
        title: What is the legal status of the business?
        type: RadiosField
        list: legalStatusList
        options:
          customValidationMessages:
            any.required: Select the legal status of the business

  - title: You cannot apply for a grant from this scheme
    path: /legal-status-cannot-apply
    controller: TerminalPageController
    components:
      - name: legalStatusCannotApplyInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">Your business does not have an eligible legal status.</p>
      - type: Html
        name: legalStatusWarning
        title: Html
        content: |-
          <div class="govuk-warning-text"> <span class="govuk-warning-text__icon" aria-hidden="true">!</span> <strong class="govuk-warning-text__text"> <span class="govuk-visually-hidden">Warning</span>Other types of business may be supported in future schemes.</strong></div>
    condition: legalStatusCondition

  - title: Is the planned project in England?
    path: /country
    components:
      - name: isInEngland
        title: Is the planned project in England?
        hint: The site where the work will happen
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if the project is in England

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-country
    controller: TerminalPageController
    components:
      - name: countryCannotApplyInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">This grant is only for projects in England.</p>
          <div class="govuk-inset-text">Scotland, Wales and Northern Ireland have other grants available.</div>
    condition: countryCondition

  - title: Does the project have planning permission?
    path: /planning-permission
    components:
      - name: planningPermissionStatus
        title: Does the project have planning permission?
        type: RadiosField
        list: planningPermissionList
        options:
          customValidationMessages:
            any.required: Select when the project will have planning permission

  - title: You may be able to apply for a grant from this scheme
    path: /planning-permission-may-apply
    components:
      - name: planningPermissionMayApplyInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">You must have secured planning permission before you submit a full application. The application deadline is 31 May 2025</p>
      - name: planningPermissionMayApplyLink
        title: Html
        type: Html
        content: |-
          <p class='govuk-body'><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: planningPermissionShouldBeCondition

  - title: You cannot apply for a grant from this scheme
    path: /planning-permission-cannot-apply
    controller: TerminalPageController
    components:
      - name: planningPermissionCannotApplyInfo
        type: Html
        title: Html
        content: |-
          <p class="govuk-body">You must have secured planning permission before you submit a full application.</p>
          <p class='govuk-body'><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: planningPermissionWillNotCondition

  - title: Have you already started work on the project?
    path: /project-start
    components:
      - name: projectStartStatus
        title: Have you already started work on the project?
        type: RadiosField
        list: projectStartList
        options:
          customValidationMessages:
            any.required: Select the option that applies to your project

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-project-start
    controller: TerminalPageController
    components:
      - name: cannotApplyProjectStartInfo
        type: Html
        title: Html
        content: |-
          <p class="govuk-body">You cannot apply for a grant if you have already started work on the project.</p>
          <div class="govuk-inset-text">Starting the project or committing to any costs (such as placing orders) before you receive a funding agreement invalidates your application.</div><p class='govuk-body'><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: projectStartCondition

  - title: Is the planned project on land the business owns?
    path: /tenancy
    components:
      - name: isLandBusinessOwned
        title: Is the planned project on land the business owns?
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if the planned project is on land the business owns

  - title: Do you have a tenancy agreement for 5 years after the final grant payment?
    path: /tenancy-length
    components:
      - name: hasFiveYearTenancyAgreement
        title: Do you have a tenancy agreement for 5 years after the final grant payment?
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if the land has a tenancy agreement in place for 5 years after the final grant payment.
    condition: tenancyCondition

  - title: You may be able to apply for a grant from this scheme
    path: /may-apply-tenancy-length
    components:
      - name: mayApplyTenancyLengthInfo
        type: Html
        title: Html
        content: |-
          <p class="govuk-body">You will need to extend your tenancy agreement for 5 years after the final grant payment.</p>
    condition: tenancyLengthCondition

  - title: Do you want to build a new smaller abattoir?
    path: /smaller-abattoir
    components:
      - name: isBuildingSmallerAbattoir
        title: Do you want to build a new smaller abattoir?
        type: YesNoField
        hint: A smaller abattoir is a red meat abattoir that processes up to 10,000 livestock units each year or a poultry abattoir that slaughters up to 500,000 birds each year.
        options:
          customValidationMessages:
            any.required: Select yes if you want to build a new smaller abattoir

  - title: Will this abattoir provide services to other farmers?
    path: /other-farmers
    components:
      - name: isProvidingServicesToOtherFarmers
        title: Will this abattoir provide services to other farmers?
        hint: For example, farmers pay you to slaughter their livestock.
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if this abattoir will provide services to other farmers
    condition: smallerAbattoirConditionYes

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-other-farmers
    controller: TerminalPageController
    components:
      - type: Html
        name: cannotApplyOtherFarmersInfo
        title: Html
        content: |-
          <p class="govuk-body">You must provide some abattoir services to other farmers if you are building a new smaller abattoir with this grant.</p>
          <p class="govuk-body"><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: otherFarmersConditionNo

  - title: Do you want to build new controlled atmosphere storage for top fruit?
    path: /fruit-storage
    components:
      - name: isBuildingFruitStorage
        title: Do you want to build new controlled atmosphere storage for top fruit?
        hint: Fruit that grows on trees, for example apples, pears, quinces, medlars, plums, peaches, apricots and cherries
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if you want to build new controlled atmosphere storage for top fruit
    condition: smallerAbattoirConditionNo

  - title: What eligible items does your project need?
    path: /project-items
    components:
      - name: eligibleItemsNeeded
        title: What eligible items does your project need?
        hint:
          Storage facilities will only be funded as part of a bigger project and cannot be more than 50% of the total grant funding.

          Select all the items your project needs
        type: CheckboxesField
        list: projectItemsList
        options:
          customValidationMessages:
            any.required: Select all the items your project needs
    condition: otherFarmersYesOrFruitStorageCondition

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-project-items
    controller: TerminalPageController
    components:
      - type: Html
        name: cannotApplyProjectItemsInfo
        title: Html
        content: |-
          <p class="govuk-body">This grant is for:</p>

          <ul class="govuk-list govuk-list--bullet">
          <li>constructing or improving buildings for processing</li>
          <li>processing equipment or machinery</li>
          <li>retail facilities</li>
          </ul>
          <p class="govuk-body"><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: projectItemsCondition

  - title: Does your project also need storage facilities?
    path: /storage
    components:
      - name: needsStorageFacilities
        title: Does your project also need storage facilities?
        hint: For example, cold stores or controlled atmosphere storage
        type: RadiosField
        list: storageRadiosList
        options:
          customValidationMessages:
            any.required: Select yes if you will need storage facilities
      - type: Html
        name: storageWarning
        title: Html
        content: |-
          <div class="govuk-warning-text"> <span class="govuk-warning-text__icon" aria-hidden="true">!</span> <strong class="govuk-warning-text__text"> <span class="govuk-visually-hidden">Warning</span>Storage facilities cannot be more than 50% of the total grant funding.</strong></div>
    condition: otherFarmersYesOrFruitStorageCondition

  - title: What is the estimated cost of the items?
    path: /project-cost
    components:
      - name: projectCostInfo
        type: Html
        title: Html
        content: |-
          <p class="govuk-hint">Do not include VAT<br><br>Enter cost of items, for example {{ 695000 | formatCurrency: 'en-GB', 'GBP', 0, 'decimal' }}</p>
      - name: estimatedCost
        type: NumberField
        title: Enter amount
        options:
          prefix: Â£
          required: true
          classes: govuk-!-width-one-third
          customValidationMessages:
            any.required: Enter the estimated cost of the items
            number.max: Enter a whole number with a maximum of 7 digits
            number.min: Enter a whole number with a maximum of 7 digits
        schema:
          min: 1
          max: 9999999
          precision: 0

  - title: You cannot apply for a grant from this scheme
    path: /project-cost-cannot-apply
    controller: TerminalPageController
    components:
      - name: projectCostCannotApplyInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">The minimum grant you can apply for is Â£25,000 (40% of Â£62,500).</p>

          <p class='govuk-body'><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: projectCostCondition

  - title: Potential grant funding
    path: /potential-funding
    components:
      - name: potentialFundingInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body"> {% assign estimatedCost = 'estimatedCost' | answer %} {% assign eligibilityMultiplier = 0.4 %} {% assign eligibilityAmount = estimatedCost | times: eligibilityMultiplier %} {% if eligibilityAmount <= 300000 and eligibilityAmount >= 25000 %} You may be able to apply for grant funding of up to {{ eligibilityAmount | formatCurrency: 'en-GB', 'GBP', 0 }} (40% of {{ estimatedCost | formatCurrency: 'en-GB', 'GBP', 0 }}).{% elsif eligibilityAmount > 300000 %} You may be able to apply for grant funding of up to Â£300,000, based on the estimated cost of {{ estimatedCost | formatCurrency: 'en-GB', 'GBP', 0 }}.


          <div class="govuk-inset-text">The maximum grant you can apply for is Â£300,000.</div> {% endif %}</p>
        options: {}
        schema: {}
      - type: Html
        name: potentialFundingWarning
        title: Html
        content: |-
          <div class="govuk-warning-text"> <span class="govuk-warning-text__icon" aria-hidden="true">!</span> <strong class="govuk-warning-text__text"> <span class="govuk-visually-hidden">Warning</span>There's no guarantee the project will receive a grant.</strong></div>
        options: {}
        schema: {}

  - title: "{% assign estimatedCost = 'estimatedCost' | answer %} {% assign applicantPayMultiplier = 0.6 %} {% assign applicantPayAmount = estimatedCost | times: applicantPayMultiplier %} {% assign grantPayAmount = estimatedCost | minus: applicantPayAmount %} {% if grantPayAmount >= 300000 %} {% assign applicantPayAmount = estimatedCost | minus: 300000 %} {% endif %} Can you pay the remaining costs of {{ applicantPayAmount | formatCurrency: 'en-GB', 'GBP', 0 }}?"
    path: /remaining-costs
    components:
      - type: YesNoField
        name: canPayRemainingCosts
        title: Can you pay the remaining costs?
        options:
          customValidationMessages:
            any.required: Select yes if you can pay the remaining costs

  - title: You cannot apply for a grant from this scheme
    path: /cannot-apply-remaining-costs
    controller: TerminalPageController
    components:
      - name: cannotApplyRemainingCostsInfo
        title: Html
        type: Html
        content: |-
          <p class="govuk-body">You cannot use public money (for example, grant funding from government or local authorities) towards the project costs.</br></br>You also cannot use money from a producer organisation under the Fresh Fruit and Vegetable Aid Scheme.</br></br>For example, you can use:</p>

          <ul class="govuk-list govuk-list--bullet">
          <li>loans</li>
          <li>overdrafts</li>
          <li>delinked payments</li></ul>

          <p class='govuk-body'><a href='https://www.gov.uk/guidance/funding-for-farmers' class='govuk-link govuk-link--no-visited-state'>See other grants you may be eligible for</a></p>
    condition: remainingCostsCondition

  - title: What type of produce is being processed?
    path: /produce-processed
    components:
      - name: processedProduceType
        title: What type of produce is being processed?
        type: RadiosField
        list: produceProcessedList
        hint: Select one option
        options:
          customValidationMessages:
            any.required: Select what type of produce is being processed
    condition: otherFarmersYesOrFruitStorageCondition

  - title: How will this project add value to the produce?
    path: /how-adding-value
    components:
      - name: valueAdditionMethod
        title: How will this project add value to the produce?
        type: RadiosField
        list: howAddingValueList
        hint: Select the main option that applies
        options:
          customValidationMessages:
            any.required: Select how this project will add value to the produce
    condition: otherFarmersYesOrFruitStorageCondition

  - title: What impact will this project have?
    path: /project-impact
    components:
      - name: impactType
        title: What impact will the project have?
        type: CheckboxesField
        list: projectImpactList
        hint: Select all that apply
        options:
          customValidationMessages:
            any.required: Select what impact this project will have
    condition: otherFarmersYesOrFruitStorageCondition

  - title: Will this project use any mechanisation instead of manual labour?
    path: /mechanisation
    components:
      - name: hasMechanisationUsage
        title: Will this project use any mechanisation instead of manual labour?
        hint: For example, a fruit grading and sorting machine that does the work of 2 farm labourers
        type: YesNoField
        options:
          customValidationMessages:
            any.required: Select yes if this project will use any mechanisation instead of manual labour

  - title: How much manual labour will the mechanisation be equal to?
    path: /manual-labour-amount
    components:
      - name: manualLabourEquivalence
        title: How much manual labour will the mechanisation be equal to?
        type: RadiosField
        list: manualLabourAmountList
        hint: Based on your current staff numbers
        options:
          customValidationMessages:
            any.required: Select how much manual labour the mechanisation will be equal to
    condition: mechanisationCondition

  - title: Who will your new customers be after the project?
    path: /future-customers

  - title: Will you work in partnership or collaborate with other farmers or producers?
    path: /collaboration

  - title: How will this project improve the environment?
    path: /environmental-impact

  - title: Score results
    path: /score-results
    view: score-results.html
    events:
      onLoad:
        type: http
        options:
          method: POST
          url: https://ffc-grants-scoring.cdpEnvironment.cdp-int.defra.cloud/scoring/api/v1/adding-value/score?allowPartialScoring=true

  - title: Business Details
    path: /business-details

  - title: Who is applying for this grant?
    path: /applying
    components:
      - name: grantApplicantType
        title: Who is applying for this grant?
        type: RadiosField
        list: applyingList
        options:
          customValidationMessages:
            any.required: Select who is applying for this grant

  - title: Agent's details
    path: /agent-details
    components:
      - type: TextField
        name: agentFirstName
        title: First name
        options:
          required: true
          customValidationMessages:
            string.empty: Enter your first name
            string.max: First name must be 30 characters or fewer
            string.pattern.base: First name must only include letters, hyphens and apostrophes
        schema:
          regex: "^[a-zA-Z' -]*$"
          max: 30
      - type: TextField
        name: agentLastName
        title: Last name
        options:
          required: true
          customValidationMessages:
            string.empty: Enter your last name
            string.max: Last name must be 30 characters or fewer
            string.pattern.base: Last name must only include letters, hyphens and apostrophes
        schema:
          regex: "^[a-zA-Z' -]*$"
          max: 30
      - type: TextField
        name: agentBusinessName
        title: Business name
        options:
          required: true
          customValidationMessages:
            string.empty: Enter your business name
            string.max: Business name must be 30 characters or fewer
        schema:
          max: 30
      - type: EmailAddressField
        name: agentEmail
        title: Email address
        hint: We will only use this to send you a confirmation
        options:
          required: true
          customValidationMessages:
            string.empty: Enter your email address
            string.email: Enter an email address in the correct format, like name@example.com
        schema:
          regex: "^\\w+([.-]\\w+)*@[a-zA-Z0-9]+(-[a-zA-Z0-9]+)*(\\.[a-zA-Z]{2,})+$"
      - type: EmailAddressField
        name: agentEmailConfirmation
        title: Confirm email address
        options:
          required: true
          customValidationMessages:
            string.empty: Confirm your email address
            string.email: Enter an email address that matches
        schema:
          regex: "^\\w+([.-]\\w+)*@[a-zA-Z0-9]+(-[a-zA-Z0-9]+)*(\\.[a-zA-Z]{2,})+$"
      - type: TelephoneNumberField
        name: agentMobile
        title: Mobile number
        hint: We will only use this to contact you about your application
        options:
          required: true
          customValidationMessages:
            string.empty: Enter a mobile number
            string.pattern.base: Enter a telephone number, like 01632 960 001, 07700 900 982 or +44 0808 157 0192
        schema:
          regex: "^\\+?[0-9\\s()-]{10,}$"
      - type: TelephoneNumberField
        name: agentLandline
        title: Landline number
        hint: We will only use this to contact you about your application
        options:
          required: true
          customValidationMessages:
            string.empty: Enter a landline number
            string.pattern.base: Enter a telephone number, like 01632 960 001, 07700 900 982 or +44 0808 157 0192
        schema:
          regex: "^\\+?[0-9\\s()-]{10,}$"
      - type: Html
        name: agentBusinessAddressHeader
        title: Html
        content: <h1 class="govuk-heading-m">Business address</h1>
      - type: UkAddressField
        title: Address
        name: agentBusinessAddress
    condition: agentDetailsSelected

  - title: Applicant's details
    path: /applicant-details
    components:
      - type: TextField
        name: applicantFirstName
        title: First name
        options:
          required: true
          customValidationMessages:
            string.empty: Enter your first name
            string.max: First name must be 30 characters or fewer
            string.pattern.base: First name must only include letters, hyphens and apostrophes
        schema:
          regex: "^[a-zA-Z' -]*$"
